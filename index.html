<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ğŸ“š è‡ªå­¦ãƒã‚¿ </title>
<style>
  :root{
    --bg:#fffef8; --card:#fff; --accent:#2962ff; --muted:#666;
    --accent-2:#00bfa5;
  }
  body{font-family:"Noto Sans JP",system-ui,Segoe UI,Arial,sans-serif;background:var(--bg);margin:0;color:#222;}
  header{background:#ffd54f;padding:14px 18px;font-weight:800;border-bottom:4px solid rgba(0,0,0,0.04);}
  .container{max-width:1200px;margin:18px auto;padding:0 16px;}
  .controls{display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin-bottom:12px;}
  .controls label{font-weight:700;margin-right:6px;}
  select,input,button{padding:8px;border-radius:8px;border:1px solid #ddd;font-size:0.95rem;}
  button{background:var(--accent);color:#fff;border:none;cursor:pointer;font-weight:700;}
  .meta{margin-left:auto;color:var(--muted);font-size:0.95rem;}
  .list-wrap{background:transparent;margin-top:8px;}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:10px;}
  .card{background:var(--card);padding:10px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.04);line-height:1.4;position:relative;}
  .tag{display:inline-block;background:#f0f7ff;color:#0366d6;padding:4px 8px;border-radius:999px;font-weight:700;margin-right:8px;font-size:0.82rem;}
  .time{display:inline-block;background:#f7f7f7;color:#444;padding:4px 8px;border-radius:999px;font-size:0.82rem;margin-right:8px;}
  .title{font-weight:800;margin-top:8px;}
  .tools{display:flex;gap:6px;align-items:center;margin-top:8px;flex-wrap:wrap;}
  .fav{position:absolute;right:10px;top:10px;border-radius:6px;padding:6px;background:#fff;border:1px solid #eee;cursor:pointer;}
  .fav.active{background:var(--accent-2);color:white;border-color:transparent;}
  .pager{display:flex;gap:8px;align-items:center;justify-content:center;margin-top:12px;}
  .small{font-size:0.85rem;color:var(--muted);}
  textarea#staticOut{width:100%;height:220px;margin-top:10px;padding:10px;border-radius:8px;border:1px solid #ccc;font-family:monospace;white-space:pre-wrap;overflow:auto;}
  .top-row{display:flex;gap:12px;align-items:center;flex-wrap:wrap;}
  .left-col{flex:1;display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
  .right-col{display:flex;align-items:center;gap:8px;}
  footer{margin:28px 0 60px;color:var(--muted);font-size:0.9rem;text-align:center;}
  @media(max-width:720px){ .grid{grid-template-columns:repeat(auto-fit,minmax(220px,1fr));} .meta{margin-left:0;}}
</style>
</head>
<body>
<header>
  ğŸ“š è‡ªå­¦ãƒã‚¿
</header>

<div class="container">
  <div class="controls top-row">
    <div class="left-col">
      <label for="genreFilter">ã‚¸ãƒ£ãƒ³ãƒ«</label>
      <select id="genreFilter"><option value="all">ã™ã¹ã¦</option></select>

      <label for="timeFilter">æ‰€è¦æ™‚é–“</label>
      <select id="timeFilter"><option value="all">ã™ã¹ã¦</option></select>

      <label for="searchBox">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</label>
      <input id="searchBox" placeholder="ä¾‹: æ˜Ÿ / å®Ÿé¨“ / è‹±èª" style="min-width:200px"/>

      <label for="perPage">è¡¨ç¤ºæ•°</label>
      <select id="perPage">
        <option value="12">12</option>
        <option value="24" selected>24</option>
        <option value="48">48</option>
        <option value="96">96</option>
      </select>
    </div>

    <div class="right-col">
      <div class="meta">è¡¨ç¤ºï¼š<span id="shownCount">0</span> / <span id="totalCount">0</span></div>
    </div>
  </div>

  <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:8px;">
    <button id="shuffleBtn" type="button">ğŸ”€ ã‚·ãƒ£ãƒƒãƒ•ãƒ«</button>
    <button id="showFavBtn" type="button">â˜… ãŠæ°—ã«å…¥ã‚Šã®ã¿</button>
    <button id="exportBtn" type="button">ğŸ“„ è¡¨ç¤ºä¸­ã‚’ &lt;li&gt; å‡ºåŠ›</button>
    <button id="downloadBtn" type="button">â¬‡ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆè¡¨ç¤ºä¸­ï¼‰</button>
    <button id="copyBtn" type="button">ğŸ“‹ ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼</button>
    <div class="small">ï¼ˆ/ã§æ¤œç´¢ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ï¼‰</div>
  </div>

  <div class="list-wrap">
    <div class="grid" id="ideasGrid" aria-live="polite"></div>

    <div class="pager" id="pager">
      <button id="prevBtn" type="button">â—€ å‰ã¸</button>
      <div class="small">ãƒšãƒ¼ã‚¸ <span id="curPage">1</span> / <span id="pageCount">1</span></div>
      <button id="nextBtn" type="button">æ¬¡ã¸ â–¶</button>
    </div>

    <div style="margin-top:12px;">
      <textarea id="staticOut" placeholder="ã€è¡¨ç¤ºä¸­ã®é …ç›®ã‚’ &lt;li&gt; å½¢å¼ã§ã“ã“ã«å‡ºåŠ›ã€"></textarea>
    </div>
  </div>

  
<script>
/* -------------------------
   ãƒ‡ãƒ¼ã‚¿ï¼†ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯
   ------------------------- */
const GENRES = ["ç†ç§‘","ç¤¾ä¼š","å›½èª","ç®—æ•°","è‹±èª","ç”Ÿæ´»","å›³å·¥","éŸ³æ¥½","ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°","é›‘å­¦"];
const TIMES = ["ç´„5åˆ†","ç´„10åˆ†","ç´„15åˆ†","ç´„20åˆ†","ç´„30åˆ†"];
const SUBJECTS = [
  "èº«è¿‘ãªã€‡ã€‡ã‚’è¦³å¯Ÿã—ã¦è¨˜éŒ²ã™ã‚‹",
  "ç°¡å˜ãªå®Ÿé¨“ã§ã€‡ã€‡ã®ä»•çµ„ã¿ã‚’ç¢ºã‹ã‚ã‚‹",
  "ã€‡ã€‡ã®æ­´å²ã‚’èª¿ã¹ã¦å¹´è¡¨ã«ã™ã‚‹",
  "ã€‡ã€‡ã®å†™çœŸã‚’é›†ã‚ã¦ç‰¹å¾´ã‚’ã¾ã¨ã‚ã‚‹",
  "ã€‡ã€‡ã®ä½œã‚Šæ–¹ã‚’èª¿ã¹ã¦å®Ÿéš›ã«ä½œã£ã¦ã¿ã‚‹",
  "ã€‡ã€‡ã®è¨€è‘‰ã‚’10å€‹è¦šãˆã¦ä¾‹æ–‡ã‚’ä½œã‚‹",
  "ã€‡ã€‡ã®ãƒ‡ãƒ¼ã‚¿ã‚’é›†ã‚ã¦ã‚°ãƒ©ãƒ•ã«ã™ã‚‹",
  "ã€‡ã€‡ã«ã¤ã„ã¦ã®ãƒŸãƒ‹ãƒ—ãƒ¬ã‚¼ãƒ³ã‚’ä½œã‚‹",
  "ã€‡ã€‡ã®é•ã„ã‚’æ¯”è¼ƒã—ã¦è¡¨ã«ã¾ã¨ã‚ã‚‹",
  "ã€‡ã€‡ã®èª­ã¿ç‰©ã‚’èª­ã‚“ã§è¦ç´„ã‚’æ›¸ã",
  "ã€‡ã€‡ã‚’ãƒ†ãƒ¼ãƒã«çŸ­ã„ç‰©èªã‚’æ›¸ã",
  "ã€‡ã€‡ã®å›³è§£ã‚’ä½œã‚‹",
  "ã€‡ã€‡ã®å®Ÿç‰©ã‚’è¦³å¯Ÿã—ã¦ã‚¹ã‚±ãƒƒãƒã™ã‚‹",
  "ã€‡ã€‡ã®å®Ÿé¨“æ‰‹é †ã¨çµæœã‚’ãƒ¬ãƒãƒ¼ãƒˆã«ã™ã‚‹",
  "ã€‡ã€‡ã®è‹±èªè¡¨ç¾ã‚’ã¾ã¨ã‚ã¦ä¼šè©±ä¾‹ã‚’ä½œã‚‹",
  "ã€‡ã€‡ã«é–¢ã™ã‚‹ã‚¯ã‚¤ã‚ºã‚’10å•ä½œã‚‹",
  "ã€‡ã€‡ã«ã¤ã„ã¦ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼ã—ã¦è¨˜äº‹ã«ã™ã‚‹",
  "ã€‡ã€‡ã®ç¨®é¡ã‚’5ã¤èª¿ã¹ã‚‹",
  "ã€‡ã€‡ã‚’5åˆ†ã§èª¬æ˜ã™ã‚‹ç·´ç¿’ã‚’ã™ã‚‹",
  "ã€‡ã€‡ã®å·¥ä½œã‚’ã—ã¦å·¥ç¨‹ã‚’å†™çœŸã§æ®‹ã™"
];
const SUBJECT_FILL = {
  "ç†ç§‘": ["æ¤ç‰©ã®è‘‰","æ°´ã®çŠ¶æ…‹å¤‰åŒ–","æœˆã®è¦³å¯Ÿ","éŸ³ã®ä¼ã‚ã‚Šæ–¹","ç£çŸ³ã®æ€§è³ª","é›»æ°—ã®æµã‚Œ"],
  "ç¤¾ä¼š": ["çœŒã®åç”£","æ­´å²ä¸Šã®å‡ºæ¥äº‹","ä¸–ç•Œã®ç¥æ—¥","æœ‰åãªéºè·¡","åœ°åŸŸã®ç”£æ¥­"],
  "å›½èª": ["å¥½ããªæœ¬ã®ä¸€ç¯€","ã“ã¨ã‚ã–","æ¼¢å­—ã®æˆã‚Šç«‹ã¡","è©©ã®åˆ†æ"],
  "ç®—æ•°": ["å›³å½¢ã®é¢ç©","å‰²åˆã®å•é¡Œ","æ™‚è¨ˆã®è¨ˆç®—","é€Ÿã•ã®å•é¡Œ"],
  "è‹±èª": ["è‡ªå·±ç´¹ä»‹ãƒ•ãƒ¬ãƒ¼ã‚º","å¤©æ°—ã®è¡¨ç¾","å‹•ç‰©ã®åå‰","ç°¡å˜ãªä¼šè©±"],
  "ç”Ÿæ´»": ["ç¯€æ°´ã®ã‚³ãƒ„","ç°¡å˜ãƒ¬ã‚·ãƒ”","é˜²ç½ãƒã‚§ãƒƒã‚¯","å®¶ã®é›»åŠ›ãƒã‚§ãƒƒã‚¯"],
  "å›³å·¥": ["æŠ˜ã‚Šç´™ä½œå“","ã‚³ãƒ©ãƒ¼ã‚¸ãƒ¥","ã‚¹ã‚±ãƒƒãƒ","æ¨¡å‹ä½œã‚Š"],
  "éŸ³æ¥½": ["ãƒªã‚ºãƒ ç·´ç¿’","æ¥½å™¨ã®æ­´å²","ç°¡å˜ãªæ—‹å¾‹ä½œã‚Š"],
  "ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°": ["HTMLè‡ªå·±ç´¹ä»‹ãƒšãƒ¼ã‚¸","ç°¡å˜ãªè¨ˆç®—ãƒ—ãƒ­ã‚°ãƒ©ãƒ ","ãƒ©ãƒ³ãƒ€ãƒ è©©ç”Ÿæˆ"],
  "é›‘å­¦": ["ä¸–ç•Œã®ä¸æ€è­°ãªäº‹å®Ÿ","é£Ÿå“ã®ãƒˆãƒªãƒ“ã‚¢","è¨˜å¿µæ—¥ã®ç”±æ¥"]
};
const EXTRA = [
  "çµæœã‚’å†™çœŸã‚„å›³ã§è¨˜éŒ²ã—ã‚ˆã†ã€‚",
  "1åˆ†ã§è¦ç‚¹ã‚’ã¾ã¨ã‚ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ã¿ã‚ˆã†ã€‚",
  "å®¶ã®äººã«ç™ºè¡¨ã—ã¦ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ã‚‚ã‚‰ãŠã†ã€‚",
  "3ã¤ã®ãƒã‚¤ãƒ³ãƒˆã«åˆ†ã‘ã¦ãƒãƒ¼ãƒˆã«ã¾ã¨ã‚ã‚ˆã†ã€‚",
  "è¡¨ã‚„ã‚°ãƒ©ãƒ•ã‚’å¿…ãš1ã¤ä½œã‚‹ã“ã¨ã‚’ç›®æ¨™ã«ã—ã‚ˆã†ã€‚",
  "å®‰å…¨ã«æ°—ã‚’ã¤ã‘ã¦å®Ÿé¨“ã‚’è¡ŒãŠã†ã€‚",
  "è‹±èªã§ã‚‚çŸ­ã„èª¬æ˜ã‚’æ›¸ã„ã¦ã¿ã‚ˆã†ã€‚",
  "æ™‚é–“å†…ï¼ˆç›®å®‰ï¼‰ã«çµ‚ã‚ã‚‹ã‚ˆã†ã«å·¥å¤«ã—ã¦ã¿ã‚ˆã†ã€‚",
  "åœ°åŸŸã®æƒ…å ±ã‚’èª¿ã¹ã¦åœ°åŸŸè‰²ã‚’å…¥ã‚Œã‚ˆã†ã€‚",
  "å®Ÿéš›ã«ä½œã£ãŸã‚‚ã®ã‚’å†™çœŸã«æ®‹ã—ã¦ãŠã“ã†ã€‚"
];

const N = 1000;
const items = [];
for(let i=0;i<N;i++){
  const genre = GENRES[i % GENRES.length];
  const tmpl = SUBJECTS[i % SUBJECTS.length];
  const fills = SUBJECT_FILL[genre] || ["ãƒ†ãƒ¼ãƒ"];
  const fill = fills[(Math.floor(i/GENRES.length) + i) % fills.length];
  const extra = EXTRA[(i*7) % EXTRA.length];
  const base = tmpl.replace("ã€‡ã€‡", fill);
  const variant = (i % 5) === 0 ? "" : `ï¼ˆç™ºå±•ï¼š${i%5}ï¼‰`;
  const text = `${base}${variant} â€” ${extra}`;
  const time = timeForGenre(genre, i);
  items.push({id:i+1,text,genre,time});
}

function timeForGenre(g, idx){
  const base = idx % TIMES.length;
  if(g==="ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°" || g==="å›³å·¥") return TIMES[(base+2)%TIMES.length];
  if(g==="é›‘å­¦" || g==="è‹±èª") return TIMES[(base)%TIMES.length];
  return TIMES[(base+1)%TIMES.length];
}

/* -------------------------
   DOM & state
   ------------------------- */
const genreFilter = document.getElementById('genreFilter');
const timeFilter = document.getElementById('timeFilter');
const searchBox = document.getElementById('searchBox');
const perPageEl = document.getElementById('perPage');
const ideasGrid = document.getElementById('ideasGrid');
const shownCountEl = document.getElementById('shownCount');
const totalCountEl = document.getElementById('totalCount');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const curPageEl = document.getElementById('curPage');
const pageCountEl = document.getElementById('pageCount');
const staticOut = document.getElementById('staticOut');

let state = {
  page: 1,
  perPage: parseInt(perPageEl.value,10),
  showFavOnly: false,
  filters:{genre:'all', time:'all', kw:''},
  favs: new Set(JSON.parse(localStorage.getItem('study_favs')||'[]'))
};

/* init select options */
GENRES.forEach(g=>{
  const o=document.createElement('option'); o.value=g; o.textContent=g; genreFilter.appendChild(o);
});
TIMES.forEach(t=>{
  const o=document.createElement('option'); o.value=t; o.textContent=t; timeFilter.appendChild(o);
});
totalCountEl.textContent = items.length;

/* -------------------------
   render & filter
   ------------------------- */
function matchesFilters(it, filters){
  if(filters.genre !== 'all' && it.genre !== filters.genre) return false;
  if(filters.time !== 'all' && it.time !== filters.time) return false;
  if(filters.kw){
    const kw = filters.kw.toLowerCase();
    if(!(it.text.toLowerCase().includes(kw) || it.genre.toLowerCase().includes(kw))) return false;
  }
  if(state.showFavOnly && !state.favs.has(it.id)) return false;
  return true;
}

function getFiltered(){
  const f = state.filters;
  return items.filter(it=>matchesFilters(it,f));
}

function render(){
  const filtered = getFiltered();
  const total = filtered.length;
  const per = state.perPage;
  const pageCount = Math.max(1, Math.ceil(total / per));
  if(state.page > pageCount) state.page = pageCount;
  const start = (state.page-1)*per;
  const pageItems = filtered.slice(start, start+per);

  ideasGrid.innerHTML = '';
  pageItems.forEach(it=>{
    const div = document.createElement('div');
    div.className = 'card';
    div.innerHTML = `
      <button class="fav ${state.favs.has(it.id)?'active':''}" data-id="${it.id}" title="ãŠæ°—ã«å…¥ã‚Šç™»éŒ²">â˜…</button>
      <div><span class="tag">${it.genre}</span><span class="time">${it.time}</span></div>
      <div class="title">${escapeHtml(it.text)}</div>
      <div class="tools small">${escapeHtml(shortHint(it.text))}</div>
    `;
    ideasGrid.appendChild(div);
  });

  shownCountEl.textContent = total;
  curPageEl.textContent = state.page;
  pageCountEl.textContent = pageCount;
  // disable/enable pager
  prevBtn.disabled = state.page <= 1;
  nextBtn.disabled = state.page >= pageCount;
}

/* helpers */
function escapeHtml(s){ return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }
function shortHint(s){ return s.length>60? s.slice(0,60)+'...': s; }

/* -------------------------
   events
   ------------------------- */
function updateAndRender(resetPage=true){
  if(resetPage) state.page = 1;
  state.perPage = parseInt(perPageEl.value,10);
  state.filters.genre = genreFilter.value;
  state.filters.time = timeFilter.value;
  state.filters.kw = (searchBox.value||'').trim();
  render();
}

// search debounce
let debounceTimer = null;
searchBox.addEventListener('input', ()=>{
  clearTimeout(debounceTimer);
  debounceTimer = setTimeout(()=> updateAndRender(true), 220);
});
genreFilter.addEventListener('change', ()=> updateAndRender(true));
timeFilter.addEventListener('change', ()=> updateAndRender(true));
perPageEl.addEventListener('change', ()=> updateAndRender(false));

prevBtn.addEventListener('click', ()=> { if(state.page>1){ state.page--; render(); }});
nextBtn.addEventListener('click', ()=> { state.page++; render(); });

// focus shortcut '/'
document.addEventListener('keydown',(e)=>{
  if(e.key === '/') { e.preventDefault(); searchBox.focus(); }
});

// shuffle
document.getElementById('shuffleBtn').addEventListener('click', ()=>{
  // randomize items array in-place then reset
  for(let i=items.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [items[i], items[j]] = [items[j], items[i]];
  }
  updateAndRender(true);
});

// show favorites toggle
document.getElementById('showFavBtn').addEventListener('click', ()=>{
  state.showFavOnly = !state.showFavOnly;
  document.getElementById('showFavBtn').textContent = state.showFavOnly ? 'â˜… ãŠæ°—ã«å…¥ã‚Šã®ã¿ï¼ˆONï¼‰' : 'â˜… ãŠæ°—ã«å…¥ã‚Šã®ã¿';
  updateAndRender(true);
});

// delegate favorite clicks
ideasGrid.addEventListener('click', (e)=>{
  const btn = e.target.closest('.fav');
  if(!btn) return;
  const id = Number(btn.dataset.id);
  if(state.favs.has(id)){ state.favs.delete(id); btn.classList.remove('active'); }
  else { state.favs.add(id); btn.classList.add('active'); }
  // persist
  localStorage.setItem('study_favs', JSON.stringify(Array.from(state.favs)));
});

// export visible -> static <li>
document.getElementById('exportBtn').addEventListener('click', ()=>{
  const filtered = getFiltered();
  const lines = filtered.map(it=>`<li data-genre="${it.genre}" data-time="${it.time}">${it.text}</li>`);
  staticOut.value = lines.join("\n");
  // select for easy copy
  staticOut.focus(); staticOut.select();
});

// download visible
document.getElementById('downloadBtn').addEventListener('click', ()=>{
  const filtered = getFiltered();
  const lines = filtered.map(it=>`<li data-genre="${it.genre}" data-time="${it.time}">${it.text}</li>`);
  const blob = new Blob([lines.join("\n")], {type:'text/plain;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'study_visible_li.txt'; document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(url);
});

// copy to clipboard
document.getElementById('copyBtn').addEventListener('click', async ()=>{
  const text = staticOut.value || (getFiltered().map(it=>`<li data-genre="${it.genre}" data-time="${it.time}">${it.text}</li>`).join("\n"));
  try{
    await navigator.clipboard.writeText(text);
    alert('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
  } catch(e){
    alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ†ã‚­ã‚¹ãƒˆã‚’é¸æŠã—ã¦æ‰‹å‹•ã§ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚');
  }
});

// clear
document.getElementById('clearBtn').addEventListener('click', ()=>{
  genreFilter.value = 'all'; timeFilter.value='all'; searchBox.value=''; state.showFavOnly=false;
  document.getElementById('showFavBtn').textContent = 'â˜… ãŠæ°—ã«å…¥ã‚Šã®ã¿';
  updateAndRender(true);
});

/* mark fav buttons after render by re-binding (since card elements are recreated) */
const observer = new MutationObserver(()=>{ // ensure favorite buttons reflect storage
  // attach titles & toggle states (initial render sets correct class)
});
observer.observe(ideasGrid, {childList:true, subtree:true});

/* init render */
updateAndRender(true);

/* expose for debugging (optional) */
window.__study = {items, state, updateAndRender, getFiltered};

</script>
</body>
</html>

